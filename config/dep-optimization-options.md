# Опції Оптимізації Залежностей

- **Пов'язано:** [Попереднє Пакування Залежностей](/guide/dep-pre-bundling)

Якщо не зазначено інше, опції в цьому розділі застосовуються лише до оптимізатора залежностей, який використовується тільки в режимі розробки.

## optimizeDeps.entries

- **Тип:** `string | string[]`

За замовчуванням, Vite буде сканувати всі ваші `.html` файли для виявлення залежностей, які потрібно попередньо запакувати (ігноруючи `node_modules`, `build.outDir`, `__tests__` та `coverage`). Якщо вказано `build.rollupOptions.input`, Vite буде сканувати ці точки входу.

Якщо жоден з цих варіантів не підходить, ви можете вказати власні точки входу за допомогою цієї опції - значення має бути [`tinyglobby` шаблоном](https://github.com/SuperchupuDev/tinyglobby) або масивом шаблонів, які відносні до кореня проекту Vite. Це перезапише стандартне визначення точок входу. Тільки папки `node_modules` та `build.outDir` будуть ігноруватися за замовчуванням, коли `optimizeDeps.entries` явно визначено. Якщо потрібно ігнорувати інші папки, ви можете використовувати шаблон ігнорування як частину списку точок входу, позначеного початковим `!`. Якщо ви не хочете ігнорувати `node_modules` та `build.outDir`, ви можете вказати їх як буквальні шляхи (без шаблонів `tinyglobby`).

## optimizeDeps.exclude

- **Тип:** `string[]`

Залежності, які потрібно виключити з попереднього пакування.

:::warning CommonJS
Залежності CommonJS не повинні бути виключені з оптимізації. Якщо залежність ESM виключена з оптимізації, але має вкладену залежність CommonJS, залежність CommonJS повинна бути додана до `optimizeDeps.include`. Приклад:

```js twoslash
import { defineConfig } from 'vite'
// ---cut---
export default defineConfig({
  optimizeDeps: {
    include: ['esm-dep > cjs-dep'],
  },
})
```

:::

## optimizeDeps.include

- **Тип:** `string[]`

За замовчуванням, пов'язані пакети, які не знаходяться в `node_modules`, не попередньо пакуються. Використовуйте цю опцію, щоб примусово попередньо запакувати пов'язаний пакет.

**Експериментально:** Якщо ви використовуєте бібліотеку з багатьма глибокими імпортами, ви також можете вказати шаблон з кінцевим глобом, щоб попередньо запакувати всі глибокі імпорти одночасно. Це дозволить уникнути постійного попереднього пакування при використанні нового глибокого імпорту. [Залишити відгук](https://github.com/vitejs/vite/discussions/15833). Наприклад:

```js twoslash
import { defineConfig } from 'vite'
// ---cut---
export default defineConfig({
  optimizeDeps: {
    include: ['my-lib/components/**/*.vue'],
  },
})
```

## optimizeDeps.esbuildOptions

- **Тип:** [`Omit`](https://www.typescriptlang.org/docs/handbook/utility-types.html#omittype-keys)`<`[`EsbuildBuildOptions`](https://esbuild.github.io/api/#general-options)`,
| 'bundle'
| 'entryPoints'
| 'external'
| 'write'
| 'watch'
| 'outdir'
| 'outfile'
| 'outbase'
| 'outExtension'
| 'metafile'>`

Опції для передачі в esbuild під час сканування та оптимізації залежностей.

Деякі опції виключені, оскільки їх зміна не сумісна з оптимізацією залежностей Vite.

- `external` також виключено, використовуйте опцію Vite `optimizeDeps.exclude`
- `plugins` об'єднуються з плагіном залежностей Vite

## optimizeDeps.force

- **Тип:** `boolean`

Встановіть значення `true`, щоб примусово попередньо запакувати залежності, ігноруючи раніше кешовані оптимізовані залежності.

## optimizeDeps.holdUntilCrawlEnd

- **Експериментально:** [Залишити відгук](https://github.com/vitejs/vite/discussions/15834)
- **Тип:** `boolean`
- **За замовчуванням:** `true`

Коли увімкнено, результати першої оптимізації залежностей будуть утримуватися до завершення сканування всіх статичних імпортів при холодному старті. Це дозволяє уникнути повного перезавантаження сторінки, коли виявляються нові залежності і вони викликають генерацію нових загальних частин. Якщо всі залежності знайдені сканером плюс явно визначені в `include`, краще вимкнути цю опцію, щоб дозволити браузеру обробляти більше запитів паралельно.

## optimizeDeps.disabled

- **Застаріло**
- **Експериментально:** [Залишити відгук](https://github.com/vitejs/vite/discussions/13839)
- **Тип:** `boolean | 'build' | 'dev'`
- **За замовчуванням:** `'build'`

Ця опція застаріла. Починаючи з Vite 5.1, попереднє пакування залежностей під час збірки було видалено. Встановлення `optimizeDeps.disabled` в `true` або `'dev'` вимикає оптимізатор, а налаштування на `false` або `'build'` залишає оптимізатор увімкненим під час розробки.

Щоб повністю вимкнути оптимізатор, використовуйте `optimizeDeps.noDiscovery: true`, щоб заборонити автоматичне виявлення залежностей і залишити `optimizeDeps.include` невизначеним або порожнім.

:::warning
Оптимізація залежностей під час збірки була **експериментальною** функцією. Проекти, які пробували цю стратегію, також видаляли `@rollup/plugin-commonjs` за допомогою `build.commonjsOptions: { include: [] }`. Якщо ви це зробили, попередження направить вас повторно увімкнути його для підтримки пакетів тільки CJS під час збірки.
:::

## optimizeDeps.needsInterop

- **Експериментально**
- **Тип:** `string[]`

Примусово включає ESM інтероп при імпорті цих залежностей. Vite здатний правильно визначити, коли залежність потребує інтеропу, тому ця опція зазвичай не потрібна. Однак, різні комбінації залежностей можуть призвести до того, що деякі з них будуть попередньо запаковані по-різному. Додавання цих пакетів до `needsInterop` може прискорити холодний старт, уникаючи повного перезавантаження сторінки. Ви отримаєте попередження, якщо це стосується однієї з ваших залежностей, з пропозицією додати ім'я пакета до цього масиву у вашій конфігурації.
