# Продуктивність

Хоча Vite за замовчуванням швидкий, проблеми з продуктивністю можуть виникати в міру зростання вимог проекту. Цей посібник допоможе вам виявити та виправити поширені проблеми з продуктивністю, такі як:

- Повільний запуск сервера
- Повільне завантаження сторінок
- Повільні збірки

## Перевірте налаштування браузера

Деякі розширення браузера можуть заважати запитам і уповільнювати час запуску та перезавантаження для великих додатків, особливо при використанні інструментів розробника браузера. Ми рекомендуємо створити профіль лише для розробки без розширень або перейти в режим інкогніто під час використання dev-сервера Vite у таких випадках. Режим інкогніто також має бути швидшим, ніж звичайний профіль без розширень.

Dev-сервер Vite виконує жорстке кешування попередньо зібраних залежностей і реалізує швидкі відповіді 304 для вихідного коду. Вимкнення кешу під час відкритих інструментів розробника браузера може значно вплинути на час запуску та повного перезавантаження сторінки. Переконайтеся, що "Disable Cache" не ввімкнено під час роботи з сервером Vite.

## Аудит налаштованих плагінів Vite

Внутрішні та офіційні плагіни Vite оптимізовані для виконання мінімальної кількості роботи, забезпечуючи сумісність з ширшою екосистемою. Наприклад, перетворення коду використовують регулярні вирази під час розробки, але виконують повний парсинг під час збірки для забезпечення коректності.

Однак продуктивність плагінів спільноти не контролюється Vite, що може вплинути на досвід розробника. Ось кілька речей, на які варто звернути увагу при використанні додаткових плагінів Vite:

1. Великі залежності, які використовуються лише в певних випадках, слід динамічно імпортувати, щоб зменшити час запуску Node.js. Приклади рефакторингу: [vite-plugin-react#212](https://github.com/vitejs/vite-plugin-react/pull/212) та [vite-plugin-pwa#224](https://github.com/vite-pwa/vite-plugin-pwa/pull/244).

2. Гаки `buildStart`, `config` та `configResolved` не повинні виконувати тривалі та обширні операції. Ці гаки очікуються під час запуску dev-сервера, що затримує доступ до сайту в браузері.

3. Гаки `resolveId`, `load` та `transform` можуть спричинити повільніше завантаження деяких файлів. Хоча це іноді неминуче, все ж варто перевірити можливі області для оптимізації. Наприклад, перевірка, чи містить `code` певне ключове слово, або чи відповідає `id` певному розширенню, перед виконанням повного перетворення.

  Чим довше триває перетворення файлу, тим значнішим буде каскад запитів під час завантаження сайту в браузері.

  Ви можете перевірити тривалість перетворення файлу за допомогою `vite --debug plugin-transform` або [vite-plugin-inspect](https://github.com/antfu/vite-plugin-inspect). Зверніть увагу, що асинхронні операції зазвичай надають неточні часові показники, тому слід розглядати ці цифри як приблизні оцінки, але вони все ж повинні виявити найбільш витратні операції.

::: tip Профілювання
Ви можете запустити `vite --profile`, відвідати сайт і натиснути `p + enter` у вашому терміналі, щоб записати `.cpuprofile`. Інструмент, такий як [speedscope](https://www.speedscope.app), можна використовувати для перевірки профілю та виявлення вузьких місць. Ви також можете [поділитися профілями](https://chat.vite.dev) з командою Vite, щоб допомогти нам виявити проблеми з продуктивністю.
:::

## Зменшення операцій розв'язання

Розв'язання шляхів імпорту може бути витратною операцією, коли часто виникає найгірший випадок. Наприклад, Vite підтримує "вгадування" шляхів імпорту за допомогою опції [`resolve.extensions`](/config/shared-options.md#resolve-extensions), яка за замовчуванням має значення `['.mjs', '.js', '.mts', '.ts', '.jsx', '.tsx', '.json']`.

Коли ви намагаєтеся імпортувати `./Component.jsx` за допомогою `import './Component'`, Vite виконує такі кроки для його розв'язання:

1. Перевірка, чи існує `./Component`, ні.
2. Перевірка, чи існує `./Component.mjs`, ні.
3. Перевірка, чи існує `./Component.js`, ні.
4. Перевірка, чи існує `./Component.mts`, ні.
5. Перевірка, чи існує `./Component.ts`, ні.
6. Перевірка, чи існує `./Component.jsx`, так!

Як показано, для розв'язання шляху імпорту потрібно виконати загалом 6 перевірок файлової системи. Чим більше неявних імпортів у вас є, тим більше часу потрібно для розв'язання шляхів.

Отже, зазвичай краще бути явним з вашими шляхами імпорту, наприклад, `import './Component.jsx'`. Ви також можете звузити список для `resolve.extensions`, щоб зменшити загальні перевірки файлової системи, але ви повинні переконатися, що це працює для файлів у `node_modules`.

Якщо ви автор плагіна, переконайтеся, що викликаєте [`this.resolve`](https://rollupjs.org/plugin-development/#this-resolve) лише тоді, коли це необхідно, щоб зменшити кількість перевірок, зазначених вище.

::: tip TypeScript
Якщо ви використовуєте TypeScript, увімкніть `"moduleResolution": "Bundler"` та `"allowImportingTsExtensions": true` у вашому `tsconfig.json` у розділі `compilerOptions`, щоб використовувати розширення `.ts` та `.tsx` безпосередньо у вашому коді.
:::

## Уникайте файлів-барелів

Файли-барели - це файли, які повторно експортують API інших файлів у тому ж каталозі. Наприклад:

```js [src/utils/index.js]
export * from './color.js'
export * from './dom.js'
export * from './slash.js'
```

Коли ви імпортуєте лише окремий API, наприклад, `import { slash } from './utils'`, усі файли в цьому файлі-барелі потрібно завантажити та перетворити, оскільки вони можуть містити API `slash` і можуть також містити побічні ефекти, які виконуються під час ініціалізації. Це означає, що ви завантажуєте більше файлів, ніж потрібно, під час початкового завантаження сторінки, що призводить до повільнішого завантаження сторінки.

Якщо можливо, слід уникати файлів-барелів і імпортувати окремі API безпосередньо, наприклад, `import { slash } from './utils/slash.js'`. Ви можете прочитати [issue #8237](https://github.com/vitejs/vite/issues/8237) для отримання додаткової інформації.

## Підігрів часто використовуваних файлів

Dev-сервер Vite перетворює файли лише за запитом браузера, що дозволяє йому швидко запускатися і застосовувати перетворення лише для використовуваних файлів. Він також може попередньо перетворювати файли, якщо очікує, що певні файли будуть запитані незабаром. Однак каскади запитів все ще можуть виникати, якщо деякі файли займають більше часу для перетворення, ніж інші. Наприклад:

Дано граф імпорту, де лівий файл імпортує правий файл:

```
main.js -> BigComponent.vue -> big-utils.js -> large-data.json
```

Відношення імпорту можна дізнатися лише після перетворення файлу. Якщо `BigComponent.vue` займає деякий час для перетворення, `big-utils.js` має чекати своєї черги і так далі. Це спричиняє внутрішній каскад навіть з вбудованим попереднім перетворенням.

Vite дозволяє підігрівати файли, які ви знаєте, що часто використовуються, наприклад, `big-utils.js`, за допомогою опції [`server.warmup`](/config/server-options.md#server-warmup). Таким чином, `big-utils.js` буде готовий і кешований для негайного обслуговування при запиті.

Ви можете знайти файли, які часто використовуються, запустивши `vite --debug transform` і перевіривши журнали:

```bash
vite:transform 28.72ms /@vite/client +1ms
vite:transform 62.95ms /src/components/BigComponent.vue +1ms
vite:transform 102.54ms /src/utils/big-utils.js +1ms
```

```js [vite.config.js]
export default defineConfig({
  server: {
   warmup: {
    clientFiles: [
      './src/components/BigComponent.vue',
      './src/utils/big-utils.js',
    ],
   },
  },
})
```

Зверніть увагу, що слід підігрівати лише файли, які часто використовуються, щоб не перевантажувати dev-сервер Vite під час запуску. Перевірте опцію [`server.warmup`](/config/server-options.md#server-warmup) для отримання додаткової інформації.

Використання [`--open` або `server.open`](/config/server-options.html#server-open) також забезпечує приріст продуктивності, оскільки Vite автоматично підігріває точку входу вашого додатку або надану URL-адресу для відкриття.

## Використовуйте менше або рідні інструменти

Підтримка швидкості Vite з ростом кодової бази полягає у зменшенні обсягу роботи для вихідних файлів (JS/TS/CSS).

Приклади зменшення обсягу роботи:

- Використовуйте CSS замість Sass/Less/Stylus, коли це можливо (вкладеність можна обробляти за допомогою PostCSS)
- Не перетворюйте SVG у компоненти UI-фреймворків (React, Vue тощо). Імпортуйте їх як рядки або URL-адреси.
- При використанні `@vitejs/plugin-react` уникайте налаштування параметрів Babel, щоб пропустити перетворення під час збірки (буде використовуватися лише esbuild).

Приклади використання рідних інструментів:

Використання рідних інструментів часто призводить до збільшення розміру встановлення, тому це не є за замовчуванням при запуску нового проекту Vite. Але це може бути варте витрат для більших додатків.

- Спробуйте експериментальну підтримку [LightningCSS](https://github.com/vitejs/vite/discussions/13835)
- Використовуйте [`@vitejs/plugin-react-swc`](https://github.com/vitejs/vite-plugin-react-swc) замість `@vitejs/plugin-react`.

